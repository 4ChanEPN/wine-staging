From db3178f4292558456596cc31766480638d8a0f3a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michael=20M=C3=BCller?= <michael@fds-team.de>
Date: Sun, 7 Feb 2016 01:30:22 +0100
Subject: quartz: AsyncReader should return NULL as media subtype for unknown
 formats instead of failing.

---
 dlls/quartz/filesource.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/dlls/quartz/filesource.c b/dlls/quartz/filesource.c
index 33ac442..a62db2c 100644
--- a/dlls/quartz/filesource.c
+++ b/dlls/quartz/filesource.c
@@ -652,8 +652,9 @@ static HRESULT WINAPI FileSource_Load(IFileSourceFilter * iface, LPCOLESTR pszFi
             hr = GetClassMediaFile(pReader, pszFileName, &This->pmt->majortype, &This->pmt->subtype, NULL);
             if (FAILED(hr))
             {
-                CoTaskMemFree(This->pmt);
-                This->pmt = NULL;
+                memcpy(&This->pmt->majortype, &MEDIATYPE_Stream, sizeof(GUID));
+                memcpy(&This->pmt->subtype,   &MEDIASUBTYPE_NULL, sizeof(GUID));
+                hr = S_OK;
             }
         }
         else
-- 
2.7.0

