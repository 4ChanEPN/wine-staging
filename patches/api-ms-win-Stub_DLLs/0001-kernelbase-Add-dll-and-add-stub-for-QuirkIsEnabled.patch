From a3c2ca382ff462bd602e65fda389ada28268012b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michael=20M=C3=BCller?= <michael@fds-team.de>
Date: Fri, 15 Jan 2016 13:01:15 +0100
Subject: kernelbase: Add dll and add stub for QuirkIsEnabled.

---
 .../api-ms-win-core-quirks-l1-1-0.spec             |  2 +-
 dlls/kernelbase/Makefile.in                        |  3 ++
 dlls/kernelbase/kernelbase.spec                    |  2 +-
 dlls/kernelbase/misc.c                             | 37 ++++++++++++++++++++++
 dlls/shlwapi/shlwapi.spec                          |  2 +-
 tools/make_specfiles                               |  1 +
 6 files changed, 44 insertions(+), 3 deletions(-)
 create mode 100644 dlls/kernelbase/misc.c

diff --git a/dlls/api-ms-win-core-quirks-l1-1-0/api-ms-win-core-quirks-l1-1-0.spec b/dlls/api-ms-win-core-quirks-l1-1-0/api-ms-win-core-quirks-l1-1-0.spec
index 761120f6f6..54ce373b96 100644
--- a/dlls/api-ms-win-core-quirks-l1-1-0/api-ms-win-core-quirks-l1-1-0.spec
+++ b/dlls/api-ms-win-core-quirks-l1-1-0/api-ms-win-core-quirks-l1-1-0.spec
@@ -1,6 +1,6 @@
 @ stub QuirkGetData
 @ stub QuirkGetData2
-@ stub QuirkIsEnabled
+@ stdcall QuirkIsEnabled(ptr) kernelbase.QuirkIsEnabled
 @ stub QuirkIsEnabled2
 @ stub QuirkIsEnabled3
 @ stub QuirkIsEnabledForPackage
diff --git a/dlls/kernelbase/Makefile.in b/dlls/kernelbase/Makefile.in
index b9caed090b..2beb34bafd 100644
--- a/dlls/kernelbase/Makefile.in
+++ b/dlls/kernelbase/Makefile.in
@@ -1 +1,4 @@
 MODULE = kernelbase.dll
+
+C_SRCS = \
+	misc.c
diff --git a/dlls/kernelbase/kernelbase.spec b/dlls/kernelbase/kernelbase.spec
index da7c50a820..3772842ca4 100644
--- a/dlls/kernelbase/kernelbase.spec
+++ b/dlls/kernelbase/kernelbase.spec
@@ -1223,7 +1223,7 @@
 @ stdcall QueueUserWorkItem(ptr ptr long) kernel32.QueueUserWorkItem
 # @ stub QuirkGetData
 # @ stub QuirkGetData2
-# @ stub QuirkIsEnabled
+@ stdcall QuirkIsEnabled(ptr)
 # @ stub QuirkIsEnabled2
 # @ stub QuirkIsEnabled3
 # @ stub QuirkIsEnabledForPackage
diff --git a/dlls/kernelbase/misc.c b/dlls/kernelbase/misc.c
new file mode 100644
index 0000000000..be1591aee7
--- /dev/null
+++ b/dlls/kernelbase/misc.c
@@ -0,0 +1,37 @@
+/*
+ * kernelbase
+ *
+ * Copyright (c) 2016 Michael MÃ¼ller
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+
+#include "config.h"
+#include <stdarg.h>
+#include "windef.h"
+#include "winbase.h"
+
+#include "wine/debug.h"
+
+WINE_DEFAULT_DEBUG_CHANNEL(kernelbase);
+
+/***********************************************************************
+ *           QuirkIsEnabled   (KERNELBASE.@)
+ */
+BOOL WINAPI QuirkIsEnabled(void *arg)
+{
+    FIXME("(%p): stub\n", arg);
+    return FALSE;
+}
diff --git a/dlls/shlwapi/shlwapi.spec b/dlls/shlwapi/shlwapi.spec
index 6b6ead2696..7c2a9d117e 100644
--- a/dlls/shlwapi/shlwapi.spec
+++ b/dlls/shlwapi/shlwapi.spec
@@ -417,7 +417,7 @@
 417 stdcall -noname SHWinHelpOnDemandA(long str long ptr long)
 418 stdcall -ordinal MLFreeLibrary(long)
 419 stdcall -noname SHFlushSFCacheWrap()
-420 stub @ # CMemStream::Commit
+420 stub @ # CMemStream::Commit, don't forward
 421 stub -noname SHLoadPersistedDataObject
 422 stdcall -noname SHGlobalCounterCreateNamedA(str long)
 423 stdcall -noname SHGlobalCounterCreateNamedW(wstr long)
diff --git a/tools/make_specfiles b/tools/make_specfiles
index d00603a41f..7a54f75801 100755
--- a/tools/make_specfiles
+++ b/tools/make_specfiles
@@ -252,6 +252,7 @@ my @dll_groups =
  [
   "kernel32",
   "advapi32",
+  "shlwapi",
   "user32",
   "shlwapi",
   "version",
-- 
2.11.0

