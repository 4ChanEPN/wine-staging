From 4f041a785404f778e34d5ecbf1249ca79704a89d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michael=20M=C3=BCller?= <michael@fds-team.de>
Date: Thu, 14 Aug 2014 03:05:52 +0200
Subject: server: Return error when opening a terminating process.

---
 server/process.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/server/process.c b/server/process.c
index 7b9a3b2..1012a8e 100644
--- a/server/process.c
+++ b/server/process.c
@@ -1082,7 +1082,10 @@ DECL_HANDLER(open_process)
     reply->handle = 0;
     if (process)
     {
-        reply->handle = alloc_handle( current->process, process, req->access, req->attributes );
+        if (process->startup_state != STARTUP_ABORTED)
+            reply->handle = alloc_handle( current->process, process, req->access, req->attributes );
+        else
+            set_error( STATUS_INVALID_PARAMETER );
         release_object( process );
     }
 }
-- 
1.7.9.5

