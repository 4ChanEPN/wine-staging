From 27f64eefe26b79cf7f0a0c6bc640509f759aad91 Mon Sep 17 00:00:00 2001
From: Qian Hong <qhong@codeweavers.com>
Date: Thu, 22 Oct 2015 15:54:30 +0800
Subject: ntdll: Implement FileNamesInformation class support.

---
 dlls/ntdll/directory.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/dlls/ntdll/directory.c b/dlls/ntdll/directory.c
index f7fa951..30e7d1d 100644
--- a/dlls/ntdll/directory.c
+++ b/dlls/ntdll/directory.c
@@ -178,6 +178,7 @@ union file_directory_info
     FILE_FULL_DIRECTORY_INFORMATION    full;
     FILE_ID_BOTH_DIRECTORY_INFORMATION id_both;
     FILE_ID_FULL_DIRECTORY_INFORMATION id_full;
+    FILE_NAMES_INFORMATION names;
 };
 
 struct dir_data
@@ -271,6 +272,8 @@ static inline unsigned int dir_info_size( FILE_INFORMATION_CLASS class, unsigned
         return (FIELD_OFFSET( FILE_ID_BOTH_DIRECTORY_INFORMATION, FileName[len] ) + 7) & ~7;
     case FileIdFullDirectoryInformation:
         return (FIELD_OFFSET( FILE_ID_FULL_DIRECTORY_INFORMATION, FileName[len] ) + 7) & ~7;
+    case FileNamesInformation:
+        return (FIELD_OFFSET( FILE_NAMES_INFORMATION, FileName[len] ) + 7) & ~7;
     default:
         assert(0);
         return 0;
@@ -1506,6 +1509,11 @@ static union file_directory_info *append_entry( struct dir_data *dir_data, void
         filename = info->id_both.FileName;
         break;
 
+    case FileNamesInformation:
+        info->names.FileNameLength = long_len * sizeof(WCHAR);
+        filename = info->names.FileName;
+        break;
+
     default:
         assert(0);
         return NULL;
@@ -2356,6 +2364,7 @@ NTSTATUS WINAPI NtQueryDirectoryFile( HANDLE handle, HANDLE event,
     case FileFullDirectoryInformation:
     case FileIdBothDirectoryInformation:
     case FileIdFullDirectoryInformation:
+    case FileNamesInformation:
         if (length < dir_info_size( info_class, 1 )) return STATUS_INFO_LENGTH_MISMATCH;
         if (!buffer) return STATUS_ACCESS_VIOLATION;
         break;
-- 
2.8.0

