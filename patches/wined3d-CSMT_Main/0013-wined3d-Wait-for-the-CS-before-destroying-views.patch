From 2172828bc75b410e54530ced4d11bbf8aaf41ba3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20D=C3=B6singer?= <stefandoesinger@gmx.at>
Date: Sun, 24 Apr 2016 13:51:03 +0100
Subject: wined3d: Wait for the CS before destroying views.

---
 dlls/wined3d/view.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/dlls/wined3d/view.c b/dlls/wined3d/view.c
index e9e62d1..b4bc771 100644
--- a/dlls/wined3d/view.c
+++ b/dlls/wined3d/view.c
@@ -48,6 +48,12 @@ ULONG CDECL wined3d_rendertarget_view_decref(struct wined3d_rendertarget_view *v
     {
         struct wined3d_device *device = view->resource->device;
 
+        if (wined3d_settings.cs_multithreaded)
+        {
+            FIXME("Waiting for cs.\n");
+            device->cs->ops->finish(device->cs);
+        }
+
         /* Call wined3d_object_destroyed() before releasing the resource,
          * since releasing the resource may end up destroying the parent. */
         view->parent_ops->wined3d_object_destroyed(view->parent);
@@ -230,6 +236,12 @@ ULONG CDECL wined3d_shader_resource_view_decref(struct wined3d_shader_resource_v
     {
         struct wined3d_device *device = view->resource->device;
 
+        if (wined3d_settings.cs_multithreaded)
+        {
+            FIXME("Waiting for cs.\n");
+            device->cs->ops->finish(device->cs);
+        }
+
         /* Call wined3d_object_destroyed() before releasing the resource,
          * since releasing the resource may end up destroying the parent. */
         view->parent_ops->wined3d_object_destroyed(view->parent);
-- 
2.8.0

