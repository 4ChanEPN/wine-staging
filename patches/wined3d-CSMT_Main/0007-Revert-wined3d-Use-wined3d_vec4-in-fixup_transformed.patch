From 01e29442c38eff41c69cc4b99d91d8eee5bcb5ef Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Tue, 15 Nov 2016 22:09:25 +0100
Subject: Revert "wined3d: Use wined3d_vec4 in fixup_transformed_pos()."

This reverts commit 07cfeac3dd7ca41d9d9fde3a490425451c4b26b7.
---
 dlls/wined3d/buffer.c | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/dlls/wined3d/buffer.c b/dlls/wined3d/buffer.c
index 202ce32..aed9e26 100644
--- a/dlls/wined3d/buffer.c
+++ b/dlls/wined3d/buffer.c
@@ -509,19 +509,19 @@ static inline unsigned int fixup_d3dcolor(DWORD *dst_color)
     return sizeof(*dst_color);
 }
 
-static inline unsigned int fixup_transformed_pos(struct wined3d_vec4 *p)
+static inline unsigned int fixup_transformed_pos(float *p)
 {
     /* rhw conversion like in position_float4(). */
-    if (p->w != 1.0f && p->w != 0.0f)
+    if (p[3] != 1.0f && p[3] != 0.0f)
     {
-        float w = 1.0f / p->w;
-        p->x *= w;
-        p->y *= w;
-        p->z *= w;
-        p->w = w;
+        float w = 1.0f / p[3];
+        p[0] *= w;
+        p[1] *= w;
+        p[2] *= w;
+        p[3] = w;
     }
 
-    return sizeof(*p);
+    return 4 * sizeof(*p);
 }
 
 ULONG CDECL wined3d_buffer_incref(struct wined3d_buffer *buffer)
@@ -909,7 +909,7 @@ static void buffer_conversion_upload(struct wined3d_buffer *buffer, struct wined
                         j += fixup_d3dcolor((DWORD *) (data + i * buffer->stride + j));
                         break;
                     case CONV_POSITIONT:
-                        j += fixup_transformed_pos((struct wined3d_vec4 *) (data + i * buffer->stride + j));
+                        j += fixup_transformed_pos((float *) (data + i * buffer->stride + j));
                         break;
                     default:
                         FIXME("Unimplemented conversion %d in shifted conversion.\n", buffer->conversion_map[j]);
-- 
2.9.0

