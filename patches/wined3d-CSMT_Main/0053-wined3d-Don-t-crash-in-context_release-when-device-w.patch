From 9c3420b9d0fd92a9421e0b15177d4fb8b5a55601 Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Fri, 10 Feb 2017 20:31:21 +0100
Subject: wined3d: Don't crash in context_release when device was not fully
 created.

---
 dlls/wined3d/context.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/dlls/wined3d/context.c b/dlls/wined3d/context.c
index 1979a36d875..be5194daaf0 100644
--- a/dlls/wined3d/context.c
+++ b/dlls/wined3d/context.c
@@ -1353,8 +1353,11 @@ void context_release(struct wined3d_context *context)
             WARN("Context %p is not the current context.\n", context);
     }
 
-    if (wined3d_settings.cs_multithreaded && context->device->cs->thread_id != GetCurrentThreadId())
+    if (wined3d_settings.cs_multithreaded && context->device &&
+        context->device->cs->thread_id != GetCurrentThreadId())
+    {
         context->gl_info->gl_ops.gl.p_glFinish();
+    }
 
     if (!--context->level)
     {
-- 
2.11.0

