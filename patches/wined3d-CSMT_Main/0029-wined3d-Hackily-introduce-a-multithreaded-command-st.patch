From 72ac21edeb63654c59cff6da426dfc6eb9451953 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20D=C3=B6singer?= <stefan@codeweavers.com>
Date: Tue, 1 Oct 2013 14:31:56 +0200
Subject: wined3d: Hackily introduce a multithreaded command stream

---
 dlls/wined3d/cs.c           | 1 +
 dlls/wined3d/wined3d_main.c | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/dlls/wined3d/cs.c b/dlls/wined3d/cs.c
index f7d8f86d5c..659cfdf7c3 100644
--- a/dlls/wined3d/cs.c
+++ b/dlls/wined3d/cs.c
@@ -2564,6 +2564,7 @@ void wined3d_cs_destroy(struct wined3d_cs *cs)
     if (cs->thread)
     {
         wined3d_cs_emit_stop(cs);
+        WaitForSingleObject(cs->thread, INFINITE);
         CloseHandle(cs->thread);
         if (!CloseHandle(cs->event))
             ERR("Closing event failed.\n");
diff --git a/dlls/wined3d/wined3d_main.c b/dlls/wined3d/wined3d_main.c
index 9bbed2da77..b730471307 100644
--- a/dlls/wined3d/wined3d_main.c
+++ b/dlls/wined3d/wined3d_main.c
@@ -72,7 +72,7 @@ static CRITICAL_SECTION wined3d_wndproc_cs = {&wined3d_wndproc_cs_debug, -1, 0,
  * where appropriate. */
 struct wined3d_settings wined3d_settings =
 {
-    FALSE,          /* No multithreaded CS by default. */
+    TRUE,           /* Multithreaded CS by default. */
     MAKEDWORD_VERSION(1, 0), /* Default to legacy OpenGL */
     TRUE,           /* Use of GLSL enabled by default */
     ORM_FBO,        /* Use FBOs to do offscreen rendering */
-- 
2.12.2

