From 1c9ae567bdc07ccff7628ffbb829fd4f1e1c32b6 Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Tue, 1 Nov 2016 14:56:59 +0100
Subject: Revert "wined3d: Fix index offset for immediate mode draws."

This reverts commit 0581d8614784cd24340123eae520159aeb40ec0f.
---
 dlls/wined3d/drawprim.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/dlls/wined3d/drawprim.c b/dlls/wined3d/drawprim.c
index 36c8d98..bf035ae 100644
--- a/dlls/wined3d/drawprim.c
+++ b/dlls/wined3d/drawprim.c
@@ -196,10 +196,12 @@ static void draw_primitive_immediate_mode(struct wined3d_context *context, const
     if (instance_count)
         FIXME("Instancing not implemented.\n");
 
-    /* Immediate mode drawing can't make use of indices in a VBO - get the
-     * data from the index buffer. */
-    if (idx_size)
-        idx_data = wined3d_buffer_load_sysmem(state->index_buffer, context) + state->index_offset;
+    /* Immediate mode drawing can't make use of indices in a vbo - get the
+     * data from the index buffer. If the index buffer has no vbo (not
+     * supported or other reason), or with user pointer drawing idx_data
+     * will be non-NULL. */
+    if (idx_size && !idx_data)
+        idx_data = wined3d_buffer_load_sysmem(state->index_buffer, context);
 
     ops = &d3d_info->ffp_attrib_ops;
 
-- 
2.9.0

