From c8d49d6ffce2dcc3797e20bbf7649aadafea21cf Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@redhat.com>
Date: Thu, 26 Mar 2015 11:14:17 +0100
Subject: schannel_gnutls: when calling pgnutls_server_name_set ensure that the
 values are sane

---
 dlls/secur32/schannel_gnutls.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/dlls/secur32/schannel_gnutls.c b/dlls/secur32/schannel_gnutls.c
index 1173574..1ad0c76 100644
--- a/dlls/secur32/schannel_gnutls.c
+++ b/dlls/secur32/schannel_gnutls.c
@@ -188,7 +188,8 @@ void schan_imp_set_session_target(schan_imp_session session, const char *target)
 {
     gnutls_session_t s = (gnutls_session_t)session;
 
-    pgnutls_server_name_set( s, GNUTLS_NAME_DNS, target, strlen(target) );
+    if (target != NULL && strlen(target) != 0)
+        pgnutls_server_name_set( s, GNUTLS_NAME_DNS, target, strlen(target) );
 }
 
 SECURITY_STATUS schan_imp_handshake(schan_imp_session session)
-- 
2.3.3

