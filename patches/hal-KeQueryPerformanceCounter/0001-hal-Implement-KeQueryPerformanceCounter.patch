From 29ed0b32254cac13e07daea09b4288ce774688cc Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michael=20M=C3=BCller?= <michael@fds-team.de>
Date: Wed, 28 Oct 2015 22:36:01 +0100
Subject: hal: Implement KeQueryPerformanceCounter.

---
 dlls/hal/hal.c    | 10 ++++++++++
 dlls/hal/hal.spec |  2 +-
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/dlls/hal/hal.c b/dlls/hal/hal.c
index bca688e..84942ca 100644
--- a/dlls/hal/hal.c
+++ b/dlls/hal/hal.c
@@ -161,3 +161,13 @@ ULONG WINAPI READ_PORT_ULONG(ULONG *port)
     FIXME("(%p) stub!\n", port);
     return 0;
 }
+
+ULONGLONG WINAPI KeQueryPerformanceCounter(LARGE_INTEGER *frequency)
+{
+    LARGE_INTEGER counter;
+
+    TRACE("(%p)\n", frequency);
+
+    NtQueryPerformanceCounter(&counter, frequency);
+    return counter.QuadPart;
+}
diff --git a/dlls/hal/hal.spec b/dlls/hal/hal.spec
index 02f778c..821084d 100644
--- a/dlls/hal/hal.spec
+++ b/dlls/hal/hal.spec
@@ -72,7 +72,7 @@
 @ stub KeFlushWriteBuffer
 @ stdcall KeGetCurrentIrql()
 @ stub KeLowerIrql
-@ stub KeQueryPerformanceCounter
+@ stdcall -ret64 KeQueryPerformanceCounter(ptr)
 @ stub KeRaiseIrql
 @ stub KeRaiseIrqlToDpcLevel
 @ stub KeRaiseIrqlToSynchLevel
-- 
2.6.4

