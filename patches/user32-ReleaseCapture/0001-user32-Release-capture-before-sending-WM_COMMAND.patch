From 031d48634a011950fec9990d4bccf835d5b016fa Mon Sep 17 00:00:00 2001
From: Alex Henrie <alexhenrie24@gmail.com>
Date: Mon, 12 Oct 2015 01:30:51 -0600
Subject: user32: Release capture before sending WM_COMMAND.

Fixes https://bugs.winehq.org/show_bug.cgi?id=39296

Signed-off-by: Alex Henrie <alexhenrie24@gmail.com>
---
 dlls/user32/button.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/dlls/user32/button.c b/dlls/user32/button.c
index eeb3035..db479a8 100644
--- a/dlls/user32/button.c
+++ b/dlls/user32/button.c
@@ -353,9 +353,13 @@ LRESULT ButtonWndProc_common(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam,
                                 (state & BST_INDETERMINATE) ? 0 : ((state & 3) + 1), 0 );
                 break;
             }
+            ReleaseCapture();
             BUTTON_NOTIFY_PARENT(hWnd, BN_CLICKED);
         }
-        ReleaseCapture();
+        else
+        {
+            ReleaseCapture();
+        }
         break;
 
     case WM_CAPTURECHANGED:
-- 
2.6.1

