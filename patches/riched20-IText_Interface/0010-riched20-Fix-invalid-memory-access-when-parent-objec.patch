From 44c16f1f02bf269a595b914bcc55a37184fc1fa4 Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Sat, 13 Sep 2014 17:21:31 +0200
Subject: riched20: Fix invalid memory access when parent object was destroyed
 earlier than child object.

---
 dlls/riched20/richole.c | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/dlls/riched20/richole.c b/dlls/riched20/richole.c
index d3ed501..7a07a84 100644
--- a/dlls/riched20/richole.c
+++ b/dlls/riched20/richole.c
@@ -1618,10 +1618,13 @@ static ULONG WINAPI TextFont_Release(ITextFont *iface)
             ITextRange_Release(&This->txtRge->ITextRange_iface);
         else
             ITextSelection_Release(&This->txtSel->ITextSelection_iface);
-        This->reOle = NULL;
         This->txtRge = NULL;
         This->txtSel = NULL;
-        list_remove(&This->entry);
+        if (This->reOle)
+        {
+            list_remove(&This->entry);
+            This->reOle = NULL;
+        }
         heap_free(This);
     }
 
@@ -2441,10 +2444,13 @@ static ULONG WINAPI TextPara_Release(ITextPara *iface)
             ITextRange_Release(&This->txtRge->ITextRange_iface);
         else
             ITextSelection_Release(&This->txtSel->ITextSelection_iface);
-        This->reOle = NULL;
         This->txtRge = NULL;
         This->txtSel = NULL;
-        list_remove(&This->entry);
+        if (This->reOle)
+        {
+            list_remove(&This->entry);
+            This->reOle = NULL;
+        }
         heap_free(This);
     }
 
-- 
2.4.0

