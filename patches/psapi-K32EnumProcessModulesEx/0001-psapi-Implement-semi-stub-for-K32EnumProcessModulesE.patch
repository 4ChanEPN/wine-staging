From a9d202e6e62edb97ddc5d3723faf27ff47cea82d Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Sat, 29 Nov 2014 23:00:53 +0100
Subject: psapi: Implement semi-stub for K32EnumProcessModulesEx.

---
 dlls/kernel32/kernel32.spec |  1 +
 dlls/kernel32/module.c      | 14 ++++++++++++++
 dlls/psapi/psapi.spec       |  1 +
 include/psapi.h             |  1 +
 4 files changed, 17 insertions(+)

diff --git a/dlls/kernel32/kernel32.spec b/dlls/kernel32/kernel32.spec
index c072780..e7e3492 100644
--- a/dlls/kernel32/kernel32.spec
+++ b/dlls/kernel32/kernel32.spec
@@ -800,6 +800,7 @@
 @ stdcall K32EnumPageFilesA(ptr ptr)
 @ stdcall K32EnumPageFilesW(ptr ptr)
 @ stdcall K32EnumProcessModules(long ptr long ptr)
+@ stdcall K32EnumProcessModulesEx(long ptr long ptr long)
 @ stdcall K32EnumProcesses(ptr long ptr)
 @ stdcall K32GetDeviceDriverBaseNameA(ptr ptr long)
 @ stdcall K32GetDeviceDriverBaseNameW(ptr ptr long)
diff --git a/dlls/kernel32/module.c b/dlls/kernel32/module.c
index ca4cf41..2a87e66 100644
--- a/dlls/kernel32/module.c
+++ b/dlls/kernel32/module.c
@@ -1247,6 +1247,20 @@ BOOL WINAPI K32EnumProcessModules(HANDLE process, HMODULE *lphModule,
 }
 
 /***********************************************************************
+ *           K32EnumProcessModulesEx (KERNEL32.@)
+ *
+ * NOTES
+ *  Returned list is in load order.
+ */
+BOOL WINAPI K32EnumProcessModulesEx(HANDLE process, HMODULE *lphModule,
+                                    DWORD cb, DWORD *needed, DWORD filter)
+{
+    FIXME("(%p, %p, %d, %p, %d) semi-stub\n",
+          process, lphModule, cb, needed, filter);
+    return K32EnumProcessModules(process, lphModule, cb, needed);
+}
+
+/***********************************************************************
  *           K32GetModuleBaseNameW (KERNEL32.@)
  */
 DWORD WINAPI K32GetModuleBaseNameW(HANDLE process, HMODULE module,
diff --git a/dlls/psapi/psapi.spec b/dlls/psapi/psapi.spec
index 45a1325..d6116f8 100644
--- a/dlls/psapi/psapi.spec
+++ b/dlls/psapi/psapi.spec
@@ -3,6 +3,7 @@
 @ stdcall EnumPageFilesA(ptr ptr) kernel32.K32EnumPageFilesA
 @ stdcall EnumPageFilesW(ptr ptr) kernel32.K32EnumPageFilesW
 @ stdcall EnumProcessModules(long ptr long ptr) kernel32.K32EnumProcessModules
+@ stdcall EnumProcessModulesEx(long ptr long ptr long) kernel32.K32EnumProcessModulesEx
 @ stdcall EnumProcesses(ptr long ptr) kernel32.K32EnumProcesses
 @ stdcall GetDeviceDriverBaseNameA(ptr ptr long) kernel32.K32GetDeviceDriverBaseNameA
 @ stdcall GetDeviceDriverBaseNameW(ptr ptr long) kernel32.K32GetDeviceDriverBaseNameW
diff --git a/include/psapi.h b/include/psapi.h
index f031724..fbdd903 100644
--- a/include/psapi.h
+++ b/include/psapi.h
@@ -81,6 +81,7 @@ extern "C" {
 
 BOOL  WINAPI EnumProcesses(DWORD*, DWORD, DWORD*);
 BOOL  WINAPI EnumProcessModules(HANDLE, HMODULE*, DWORD, LPDWORD);
+BOOL  WINAPI EnumProcessModulesEx(HANDLE, HMODULE*, DWORD, LPDWORD, DWORD);
 DWORD WINAPI GetModuleBaseNameA(HANDLE, HMODULE, LPSTR, DWORD);
 DWORD WINAPI GetModuleBaseNameW(HANDLE, HMODULE, LPWSTR, DWORD);
 #define      GetModuleBaseName WINELIB_NAME_AW(GetModuleBaseName)
-- 
2.1.3

