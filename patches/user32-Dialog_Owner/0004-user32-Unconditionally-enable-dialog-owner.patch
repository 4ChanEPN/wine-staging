From c47e1ecc0bfdfac833dd9548b0818087bb7bc69d Mon Sep 17 00:00:00 2001
From: Dmitry Timoshkov <dmitry@baikal.ru>
Date: Wed, 30 Mar 2016 18:16:54 +0800
Subject: user32: Unconditionally enable dialog owner.

---
 dlls/user32/controls.h  | 1 -
 dlls/user32/dialog.c    | 8 ++------
 dlls/user32/tests/win.c | 3 ---
 3 files changed, 2 insertions(+), 10 deletions(-)

diff --git a/dlls/user32/controls.h b/dlls/user32/controls.h
index 69bc94c..1641645 100644
--- a/dlls/user32/controls.h
+++ b/dlls/user32/controls.h
@@ -241,7 +241,6 @@ typedef struct tagDIALOGINFO
 } DIALOGINFO;
 
 #define DF_END  0x0001
-#define DF_OWNERENABLED 0x0002
 
 extern DIALOGINFO *DIALOG_get_info( HWND hwnd, BOOL create ) DECLSPEC_HIDDEN;
 extern INT DIALOG_DoDialogBox( HWND hwnd, HWND owner ) DECLSPEC_HIDDEN;
diff --git a/dlls/user32/dialog.c b/dlls/user32/dialog.c
index d28b840..1aa954f 100644
--- a/dlls/user32/dialog.c
+++ b/dlls/user32/dialog.c
@@ -472,7 +472,6 @@ static HWND DIALOG_CreateIndirect( HINSTANCE hInst, LPCVOID dlgTemplate,
     HWND disabled_owner = NULL;
     HMENU hMenu = 0;
     HFONT hUserFont = 0;
-    UINT flags = 0;
     UINT xBaseUnit = LOWORD(units);
     UINT yBaseUnit = HIWORD(units);
 
@@ -604,10 +603,7 @@ static HWND DIALOG_CreateIndirect( HINSTANCE hInst, LPCVOID dlgTemplate,
         disabled_owner = real_owner( owner );
 
         if (IsWindowEnabled( disabled_owner ))
-        {
-            flags |= DF_OWNERENABLED;
             EnableWindow( disabled_owner, FALSE );
-        }
         else
             disabled_owner = NULL;
     }
@@ -663,7 +659,7 @@ static HWND DIALOG_CreateIndirect( HINSTANCE hInst, LPCVOID dlgTemplate,
     dlgInfo->hMenu       = hMenu;
     dlgInfo->xBaseUnit   = xBaseUnit;
     dlgInfo->yBaseUnit   = yBaseUnit;
-    dlgInfo->flags       = flags;
+    dlgInfo->flags       = 0;
 
     if (template.helpId) SetWindowContextHelpId( hwnd, template.helpId );
 
@@ -829,7 +825,7 @@ INT DIALOG_DoDialogBox( HWND hwnd, HWND owner )
             }
         }
     }
-    if (dlgInfo->flags & DF_OWNERENABLED) EnableWindow( owner, TRUE );
+    EnableWindow( owner, TRUE );
     retval = dlgInfo->idResult;
     DestroyWindow( hwnd );
     return retval;
diff --git a/dlls/user32/tests/win.c b/dlls/user32/tests/win.c
index 5ec370e..96d293d 100644
--- a/dlls/user32/tests/win.c
+++ b/dlls/user32/tests/win.c
@@ -4304,20 +4304,17 @@ static INT_PTR WINAPI empty_dlg_proc2(HWND hwnd, UINT msg, WPARAM wparam, LPARAM
         }
 
         DialogBoxIndirectParamA(GetModuleHandleA(NULL), param->dlg_data, disabled_hwnd, empty_dlg_proc3, 0);
-        todo_wine_if ((style & (WS_CHILD|WS_POPUP)) == WS_CHILD)
         ok(IsWindowEnabled(disabled_hwnd), "wrong state for %08x\n", style);
 
         ok(IsWindowEnabled(hwnd), "wrong state for %p\n", hwnd);
         ok(IsWindowEnabled(param->parent), "wrong state for %p\n", param->parent);
         if (param->grand_parent)
-        todo_wine_if ((style & (WS_CHILD|WS_POPUP)) == WS_CHILD)
             ok(IsWindowEnabled(param->grand_parent), "wrong state for %p (%08x)\n", param->grand_parent, style);
 
         DialogBoxIndirectParamA(GetModuleHandleA(NULL), param->dlg_data, hwnd, empty_dlg_proc3, 0);
         ok(IsWindowEnabled(hwnd), "wrong state for %p\n", hwnd);
         ok(IsWindowEnabled(param->parent), "wrong state for %p\n", param->parent);
         if (param->grand_parent)
-        todo_wine_if ((style & (WS_CHILD|WS_POPUP)) == WS_CHILD)
             ok(IsWindowEnabled(param->grand_parent), "wrong state for %p (%08x)\n", param->grand_parent, style);
 
         param->dlg_data->style |= WS_CHILD;
-- 
2.7.1

