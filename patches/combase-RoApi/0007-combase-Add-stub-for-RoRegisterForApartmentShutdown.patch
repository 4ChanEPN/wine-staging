From 01ba1b422251cc4a326063f8500afd1cbdce2aa6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michael=20M=C3=BCller?= <michael@fds-team.de>
Date: Sun, 17 Jan 2016 02:01:59 +0100
Subject: combase: Add stub for RoRegisterForApartmentShutdown.

---
 dlls/combase/combase.spec |  2 +-
 dlls/combase/roapi.c      | 18 ++++++++++++++++++
 2 files changed, 19 insertions(+), 1 deletion(-)

diff --git a/dlls/combase/combase.spec b/dlls/combase/combase.spec
index 3bf0bf2..7ae1f6e 100644
--- a/dlls/combase/combase.spec
+++ b/dlls/combase/combase.spec
@@ -263,7 +263,7 @@
 @ stub RoOriginateLanguageException
 @ stub RoParameterizedTypeExtraGetTypeSignature
 @ stub RoRegisterActivationFactories
-@ stub RoRegisterForApartmentShutdown
+@ stdcall RoRegisterForApartmentShutdown(ptr ptr ptr)
 @ stub RoReportCapabilityCheckFailure
 @ stub RoReportFailedDelegate
 @ stub RoReportUnhandledError
diff --git a/dlls/combase/roapi.c b/dlls/combase/roapi.c
index cd545f1..035fa47 100644
--- a/dlls/combase/roapi.c
+++ b/dlls/combase/roapi.c
@@ -218,3 +218,21 @@ HRESULT WINAPI RoGetApartmentIdentifier(UINT64 *identifier)
     *identifier = 0xdeadbeef;
     return S_OK;
 }
+
+/***********************************************************************
+ *      RoRegisterForApartmentShutdown (combase.@)
+ */
+HRESULT WINAPI RoRegisterForApartmentShutdown(IApartmentShutdown *callback,
+        UINT64 *identifier, APARTMENT_SHUTDOWN_REGISTRATION_COOKIE *cookie)
+{
+    HRESULT hr;
+
+    FIXME("(%p, %p, %p): stub\n", callback, identifier, cookie);
+
+    hr = RoGetApartmentIdentifier(identifier);
+    if (FAILED(hr))
+        return hr;
+
+    *cookie = (void *)0xcafecafe;
+    return S_OK;
+}
-- 
2.6.4

