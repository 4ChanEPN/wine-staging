From bedf1085f5229c85f990f3c0f41c62a47fef6c40 Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Sat, 28 Nov 2015 21:28:26 +0100
Subject: ntdll: Commit new guard pages in virtual_handle_stack_fault. (resend)

Signed-off-by: Sebastian Lackner <sebastian@fds-team.de>
---
 dlls/ntdll/virtual.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/ntdll/virtual.c b/dlls/ntdll/virtual.c
index 4d4bc3b..d6319d82 100644
--- a/dlls/ntdll/virtual.c
+++ b/dlls/ntdll/virtual.c
@@ -1550,7 +1550,7 @@ BOOL virtual_handle_stack_fault( void *addr )
             if ((char *)page >= (char *)NtCurrentTeb()->DeallocationStack + 2*page_size)
             {
                 vprot = view->prot[((char *)page - page_size - (char *)view->base) >> page_shift];
-                VIRTUAL_SetProt( view, (char *)page - page_size, page_size, vprot | VPROT_GUARD );
+                VIRTUAL_SetProt( view, (char *)page - page_size, page_size, vprot | VPROT_COMMITTED | VPROT_GUARD );
             }
             ret = TRUE;
         }
-- 
2.6.2

